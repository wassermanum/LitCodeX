# MVP план для Codex (исполняемый агентом)

> Этот документ предназначен для ИИ-агента (Codex). Пользователь будет давать короткие команды вроде:  
> «Выполни Фазу 1: Бэкенд каркас» или «Сделай задачу 5.3».  
> Агент выполняет задачи по порядку, **сам создаёт папки и файлы**, показывает диффы и инструкции по запуску.

## 0) Цель и демонстрационный сценарий (без авторизации)
Нужно быстро получить **рабочее** минимальное приложение «Заказы» с иллюстрацией двух ролей:
- **Роль: Группа** — создаёт заказ (форма), видит список своих заказов.
- **Роль: Местность** — видит созданный заказ, меняет статус (принять, в работе, закрыть).

Без авторизации: в интерфейсе есть **временное меню выбора текущей роли** (Группа / Местность). В релизе меню будет удалено, но для MVP оно обязательно.

**Демо-сценарий:**
1) Выбрать роль **Группа**, ввести/выбрать «Название группы», создать заказ.  
2) Переключиться на роль **Местность**, увидеть заказ в общем списке.  
3) Открыть заказ, сменить статус на «в работе», затем «закрыт» — изменения видны в UI.

## 1) Техстек (минимальный)
- **Фронтенд:** React + Vite + TypeScript + Tailwind CSS
- **Бэкенд:** Node.js >= 20 + Express
- **БД:** SQLite через Prisma (один файл БД)
- **Прочее:** npm, dotenv; (линтер/тесты — опционально и минимально)
- **Порты:** frontend 5173, api 3000
- **OS:** Linux

## 2) Доменная модель
**Order**
- `id` — Int, PK, autoincrement
- `title` — String, 1..100, обязательно
- `description` — String?, опционально
- `quantity` — Int?, опционально
- `unit` — String?, опционально (например, "шт", "кг")
- `priority` — enum: `low` | `medium` | `high` (default `medium`)
- `status` — enum: `new` | `in_progress` | `done` | `closed` (default `new`)
- `createdBy` — String, кто создал (для MVP — название группы, сохраняем из UI)
- `createdAt` — DateTime @default(now())
- `updatedAt` — DateTime @updatedAt

**Допущения для MVP:**  
- Все заказы видны всем (без ACL).  
- «Мои заказы» для роли Группа — это фильтр по `createdBy` (значение из выбранной группы в UI).  
- Местность редактирует статусы любых заказов.

**Переходы статусов (допустимые):**
- `new` → `in_progress` | `closed`
- `in_progress` → `done` | `closed`
- `done` → `closed`
(Обратных переходов нет.)

## 3) API (префикс `/api`)
- `GET /api/health` → `{ status: "ok" }`
- `GET /api/orders?status=<...>&createdBy=<...>` → `Order[]` (фильтры опциональны)
- `GET /api/orders/:id` → `Order`
- `POST /api/orders` body `{ title, description?, quantity?, unit?, priority?, createdBy }` → 201 `Order`
- `PUT /api/orders/:id` body `{ title?, description?, quantity?, unit?, priority? }` → 200 `Order`
- `PUT /api/orders/:id/status` body `{ status }` → 200 `Order` (валидация переходов по таблице выше)
- `DELETE /api/orders/:id` → 204
Ошибки: `4xx/5xx` → `{ error: string }`.

## 4) UI/UX (минимум)
- **Header:** селектор роли (`Группа` / `Местность`) и поле/селектор «Название группы» (для роли Группа; сохранять в localStorage).
- **Роль: Группа**
  - Форма создания заказа (title*, description?, quantity?, unit?, priority?)
  - Список «Мои заказы» (фильтр по `createdBy`=текущая группа)
- **Роль: Местность**
  - Список всех заказов с фильтром по статусу
  - Страница/модал «Просмотр заказа» с кнопками:  
    - `Принять` (new→in_progress)  
    - `Завершить` (in_progress→done)  
    - `Закрыть` (new|in_progress|done→closed)
- Состояния: загрузка, пустой список, ошибка запроса
- Tailwind, опрятная таблица/карточки, без сложного дизайна

## 5) Нефункциональные требования
- Простой локальный запуск, без лишних зависимостей.
- CORS включён для разработки.
- Конфиденциальные значения — через `.env` (например, `DATABASE_URL="file:./dev.db"`).
- Node >= 20 обязательно.

## 6) Критерии готовности MVP
- Фронтенд и API запускаются локально.
- Демо-сценарий из раздела 0 полностью воспроизводится.
- README с командами запуска.
- (Опц.) один smoke-тест `/health`.

---

# Порядок работ (Codex выполняет по шагам)

## Фаза 1 — Создание структуры проекта
**Задачи:**
1.1 Создать корневые папки `app/` и `api/`.  
1.2 Добавить общий `README.md` с краткими командами запуска (заполнить по факту).  
1.3 Подготовить базовый `.gitignore` (node_modules, .env, prisma/dev.db и т.п.).  
**Промпт для выполнения:**  
«Выполни Фазу 1: создай папки `app/` и `api/`, общий README и базовый `.gitignore`. Ничего лишнего не добавляй.»

## Фаза 2 — Бэкенд: каркас Express
**Задачи:**
2.1 Инициализировать `api/` (TypeScript, Express, `ts-node-dev`, `dotenv`, `cors`).  
2.2 Реализовать `GET /api/health`.  
2.3 Добавить скрипты: `dev`, `build`, `start`.  
**Промпт:**  
«Выполни Фазу 2: каркас Express в `api/` с TypeScript, CORS, `GET /api/health`. Дай файлы: `package.json`, `tsconfig.json`, `src/index.ts`, `.env.example`. Порт 3000.»

## Фаза 3 — Prisma + SQLite
**Задачи:**
3.1 Добавить Prisma в `api/`, модель `Order` согласно разделу 2 (с enum для `priority` и `status`).  
3.2 Инициализировать миграцию и клиент.  
3.3 Создать `src/prisma.ts`.  
**Промпт:**  
«Выполни Фазу 3: добавь Prisma+SQLite в `api/`. Опиши модель `Order`, создай миграцию, добавь `src/prisma.ts`. Обнови скрипты.»

## Фаза 4 — CRUD API
**Задачи:**
4.1 Реализовать маршруты: `GET /api/orders`, `GET /api/orders/:id`, `POST /api/orders`, `PUT /api/orders/:id`, `PUT /api/orders/:id/status`, `DELETE /api/orders/:id`.  
4.2 Валидация входа (минимум: title 1..100; корректность переходов статусов).  
4.3 Единый обработчик ошибок.  
4.4 Примеры `curl` в ответе.  
**Промпт:**  
«Выполни Фазу 4: реализуй CRUD и смену статусов для `Order` в `api/` (включая валидацию). Приведи примеры `curl`.»

## Фаза 5 — Фронтенд: каркас Vite + Tailwind
**Задачи:**
5.1 Инициализировать `app/` (Vite+React+TS), подключить Tailwind.  
5.2 Создать базовый `App` с шапкой и селектором роли (`Группа`/`Местность`).  
5.3 Сохранение выбранной роли и «Название группы» в localStorage.  
**Промпт:**  
«Выполни Фазу 5: создай `app/` (Vite+React+TS+Tailwind), добавь Header с выбором роли и полем “Название группы”, хранение в localStorage. Дай инструкции по запуску.»

## Фаза 6 — Связка фронта и API (ролевая логика)
**Задачи:**
6.1 Клиент `app/src/api.ts` с запросами к `/api`.  
6.2 **Роль: Группа** — форма создания заказа + список «Мои заказы» (фильтр `createdBy=<текущее значение>`).  
6.3 **Роль: Местность** — список всех заказов, просмотр, кнопки смены статуса (`new→in_progress`, `in_progress→done`, `*→closed`).  
6.4 Состояния загрузки/пусто/ошибка.  
**Промпт:**  
«Выполни Фазу 6: свяжи фронт с API. Реализуй экран Группы (создание + мои заказы) и Местности (список + смена статуса). Обработай пустые/ошибки. Дай диффы.»

## Фаза 7 — Полировка минимальная
**Задачи:**
7.1 Небольшие улучшения UX (текстовые подсказки, тосты).  
7.2 Фильтр по статусу на стороне Местности.  
7.3 Обновить README командами запуска фронта и API.  
**Промпт:**  
«Выполни Фазу 7: минимальная полировка, фильтр по статусу, обнови README. Никакого оверинжиниринга.»

## Фаза 8 — Финал (отложено до конца)
**Задачи:**
8.1 Инициализировать git и добавить `.gitignore` (если ещё нет).  
8.2 Подготовить Dockerfile(ы) и/или `docker-compose.yml` для локального поднятия `api` и `app`.  
8.3 (Опц.) Инструкции для деплоя (Render/Railway для API; Vercel/Netlify для фронта).  
**Промпт:**  
«Выполни Фазу 8: добавь git, Docker, обнови README с инструкциями. Деплой — по желанию отдельным шагом.»

---

## Запуск (ожидаемо после Фаз 2–6)
- **API:** `cd api && npm i && npx prisma migrate dev && npm run dev` → http://localhost:3000  
- **App:** `cd app && npm i && npm run dev` → http://localhost:5173

## Примечания для агента
- Всегда давать **диффы** и **точные пути файлов**.  
- Вносить **только необходимые изменения**.  
- Подтверждать выполненные задачи и предлагать следующий шаг.  
- Не добавлять авторизацию. Меню выбора роли оставить в MVP.  
- Node.js версии < 20 не поддерживать; при обнаружении — предложить обновление.
