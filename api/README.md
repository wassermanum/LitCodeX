# API (Orders Service)

Бэкенд реализован на Express + Prisma и использует SQLite по умолчанию (`file:./dev.db`).

## Требования
- Node.js 20+
- npm 10+

## Подготовка окружения
1. Установите зависимости: `npm install`
2. При необходимости отредактируйте `.env` (по умолчанию используется `PORT=3000` и `DATABASE_URL="file:./dev.db"`).
3. Накатите схему: `npm run prisma:migrate`

## Основные команды
- `npm run dev` — запуск API в режиме разработки (ts-node-dev).
- `npm run build` / `npm start` — сборка и запуск скомпилированной версии.
- `npm run prisma:studio` — открыть Prisma Studio для просмотра данных.
- `npm run literature:load` — загрузить каталог литературы (см. ниже).

## Загрузка каталога литературы
Команда `npm run literature:load` читает файл `234.txt` в корне репозитория. Каждая строка в формате `ТИП<TAB>Название<TAB>Цена`. Скрипт:
- очищает таблицы `OrderItem` и `Literature`;
- добавляет записи в `Literature` в исходном порядке (поле `sortOrder`);
- сохраняет цену в копейках (`price` — целое число, например, `350,00` → `35000`).

> ⚠️ Запуск скрипта удаляет позиции заказов, привязанные к каталогу. Выполняйте его до создания заказов или с пониманием последствий.

После импорта вы получите 107 позиций литературы, доступных для дальнейшей интеграции с UI.

## Стоимость заказов
- Каждая позиция заказа хранит цену на момент создания, поэтому дальнейшие изменения каталога не влияют на историю.
- Общая сумма заказа возвращается в ответах API (`totalAmount`, копейки) вместе с суммами по строкам (`lineTotal`).
